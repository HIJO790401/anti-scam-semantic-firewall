<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>AI Semantic Governance Engine – Anti-Scam Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050814;
      --panel: #0b1020;
      --panel-soft: #101628;
      --accent: #f6c453;
      --accent-soft: #1f2333;
      --text-main: #f5f5ff;
      --text-sub: #9fa8c6;
      --danger: #ff4b6a;
      --warn: #ffb347;
      --safe: #39d98a;
      --border: #232a3d;
      --glow-soft: 0 0 40px rgba(255, 215, 128, 0.3);
      --radius-xl: 28px;
      --radius-lg: 20px;
      --radius-md: 14px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans TC",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #1c2040 0, #050814 45%, #02030a 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    .page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 32px 16px 64px;
    }

    @media (min-width: 768px) {
      .page {
        padding: 40px 24px 80px;
      }
    }

    .hero {
      border-radius: var(--radius-xl);
      padding: 24px 20px 24px;
      background:
        radial-gradient(circle at top left, rgba(246, 196, 83, 0.16), transparent 60%),
        radial-gradient(circle at bottom right, rgba(64, 160, 255, 0.16), transparent 65%),
        linear-gradient(135deg, rgba(10, 15, 40, 0.98), rgba(6, 10, 30, 0.98));
      border: 1px solid rgba(143, 167, 255, 0.24);
      box-shadow: var(--glow-soft);
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      border: 1px solid rgba(246, 196, 83, 0.16);
      opacity: 0.8;
      pointer-events: none;
    }

    .hero-top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }

    .pill {
      padding: 4px 14px;
      border-radius: var(--radius-pill);
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(11, 16, 40, 0.85);
      color: var(--text-sub);
      white-space: nowrap;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 15px rgba(246, 196, 83, 0.7);
    }

    .pill-secondary {
      border-color: rgba(102, 153, 255, 0.4);
      color: #c3d5ff;
      background: radial-gradient(circle at top left, rgba(102, 153, 255, 0.25), rgba(11, 16, 40, 0.9));
    }

    .hero-title {
      font-size: 28px;
      line-height: 1.18;
      margin: 0 0 8px;
    }

    @media (min-width: 768px) {
      .hero-title {
        font-size: 32px;
      }
    }

    .hero-sub {
      font-size: 21px;
      font-weight: 600;
      margin: 0 0 14px;
    }

    .hero-desc {
      font-size: 14px;
      color: var(--text-sub);
      max-width: 640px;
      line-height: 1.6;
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 20px;
      margin-top: 18px;
      font-size: 13px;
      color: var(--text-sub);
    }

    .hero-meta strong {
      color: var(--text-main);
      font-weight: 600;
    }

    .hero-actions {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn-chip {
      border-radius: var(--radius-pill);
      padding: 8px 16px;
      font-size: 13px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      background: rgba(7, 10, 28, 0.9);
      color: var(--text-main);
      text-decoration: none;
    }

    .btn-chip-primary {
      border-color: rgba(87, 207, 255, 0.7);
      background: radial-gradient(circle at top left, rgba(87, 207, 255, 0.35), rgba(7, 10, 28, 0.98));
      box-shadow: 0 0 18px rgba(87, 207, 255, 0.45);
    }

    .btn-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #57cfff;
    }

    .btn-text-small {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(255, 255, 255, 0.72);
    }

    .btn-label {
      font-weight: 600;
    }

    .btn-chip span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .layout-main {
      margin-top: 26px;
      display: grid;
      gap: 18px;
    }

    @media (min-width: 960px) {
      .layout-main {
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
        align-items: flex-start;
      }
    }

    .panel {
      background: linear-gradient(145deg, rgba(5, 8, 20, 0.97), rgba(9, 13, 30, 0.98));
      border-radius: var(--radius-xl);
      border: 1px solid rgba(113, 136, 210, 0.35);
      padding: 18px 16px 20px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.75);
    }

    @media (min-width: 768px) {
      .panel {
        padding: 20px 20px 22px;
      }
    }

    .panel-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .panel-title {
      font-size: 17px;
      font-weight: 700;
    }

    .panel-subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .panel-tag {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(160, 190, 255, 0.6);
      color: #d0e0ff;
      background: rgba(12, 18, 40, 0.9);
      white-space: nowrap;
    }

    .panel-body {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .input-area {
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.03), transparent 60%),
        linear-gradient(145deg, rgba(12, 18, 40, 0.97), rgba(8, 12, 30, 0.97));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(129, 150, 220, 0.4);
      padding: 14px;
    }

    @media (min-width: 768px) {
      .input-area {
        padding: 16px 18px;
      }
    }

    .help-text {
      margin: 0 0 10px;
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.6;
    }

    textarea {
      width: 100%;
      min-height: 170px;
      resize: vertical;
      background: rgba(4, 7, 18, 0.95);
      border-radius: 14px;
      border: 1px solid rgba(60, 80, 150, 0.7);
      padding: 10px 11px;
      color: var(--text-main);
      font-size: 14px;
      line-height: 1.5;
      outline: none;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(246, 196, 83, 0.3), 0 0 25px rgba(246, 196, 83, 0.35);
    }

    .example-label {
      display: block;
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .input-footer {
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .input-footer-top {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }

    .warning {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #ffb347;
    }

    .warning-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 1px solid rgba(255, 179, 71, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
    }

    .btn {
      border-radius: var(--radius-pill);
      padding: 8px 18px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.03em;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-secondary {
      background: rgba(9, 14, 35, 0.95);
      color: var(--text-main);
      border: 1px solid rgba(146, 168, 230, 0.6);
    }

    .btn-primary {
      background: radial-gradient(circle at top, #ffd56a, #f6b739);
      color: #2b1905;
      box-shadow: 0 0 22px rgba(246, 196, 83, 0.6);
    }

    .btn-primary::before {
      content: "";
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #fffae5;
      box-shadow: 0 0 18px rgba(255, 255, 255, 0.75);
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(8, 11, 26, 0.9);
      color: var(--text-sub);
      white-space: nowrap;
    }

    .chip.badge-safe {
      border-color: rgba(57, 217, 138, 0.6);
      color: #a8ffd2;
      background: rgba(15, 45, 35, 0.95);
    }

    .chip.badge-risk {
      border-color: rgba(255, 179, 71, 0.7);
      color: #ffe6b8;
      background: rgba(60, 35, 15, 0.95);
    }

    .chip.badge-fatal {
      border-color: rgba(255, 75, 106, 0.9);
      color: #ffd6df;
      background: rgba(60, 12, 25, 0.96);
    }

    .chip.badge-idle {
      border-color: rgba(143, 167, 255, 0.6);
      color: #ccd4ff;
      background: rgba(9, 15, 40, 0.96);
    }

    .risk-panel {
      margin-top: 16px;
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.02), transparent 55%),
        linear-gradient(150deg, rgba(9, 12, 30, 0.98), rgba(6, 8, 22, 0.98));
      border: 1px solid rgba(122, 145, 215, 0.65);
      padding: 16px 14px 16px;
    }

    .risk-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .risk-title {
      font-size: 15px;
      font-weight: 600;
    }

    .risk-badge {
      font-size: 12px;
      padding: 4px 11px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(60, 80, 150, 0.8);
      color: #a8ffd2;
      background: rgba(10, 40, 26, 0.95);
    }

    .risk-body {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.6;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    @media (min-width: 768px) {
      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .mini-panel {
      border-radius: var(--radius-lg);
      padding: 10px 11px 11px;
      background: rgba(9, 13, 32, 0.98);
      border: 1px solid rgba(71, 96, 175, 0.8);
    }

    .mini-title {
      font-size: 13px;
      margin-bottom: 6px;
      color: #dbe3ff;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .mini-body {
      font-size: 12px;
      color: var(--text-sub);
      line-height: 1.55;
    }

    .status-pill {
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      font-size: 11px;
      border: 1px solid rgba(143, 167, 255, 0.7);
      color: #c2d2ff;
    }

    .status-idle {
      background: rgba(8, 12, 35, 0.96);
    }

    .status-risk {
      background: rgba(60, 35, 15, 0.96);
      border-color: rgba(255, 179, 71, 0.75);
      color: #ffe0b8;
    }

    .status-fatal {
      background: rgba(60, 12, 25, 0.96);
      border-color: rgba(255, 75, 106, 0.95);
      color: #ffd6df;
    }

    .status-safe {
      background: rgba(15, 45, 35, 0.96);
      border-color: rgba(57, 217, 138, 0.8);
      color: #a1ffd0;
    }

    .role-panel {
      margin-top: 14px;
      border-radius: var(--radius-lg);
      padding: 11px 12px 12px;
      background: rgba(6, 10, 26, 0.98);
      border: 1px solid rgba(122, 145, 215, 0.7);
    }

    .role-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 6px;
    }

    .role-title {
      font-size: 13px;
      color: #dbe3ff;
    }

    .toggle-link {
      font-size: 12px;
      color: #8fb0ff;
      text-decoration: underline;
      cursor: pointer;
    }

    .role-body {
      font-size: 12px;
      color: var(--text-sub);
      line-height: 1.6;
      display: none;
      margin-top: 4px;
    }

    .role-body.show {
      display: block;
    }

    .action-list {
      margin: 4px 0 0;
      padding-left: 18px;
    }

    .action-list li {
      margin: 3px 0;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .note {
      font-size: 12px;
      color: var(--text-sub);
      line-height: 1.6;
    }

    .note strong {
      color: var(--text-main);
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="hero-top-row">
        <div class="pill">
          <span class="pill-dot"></span>
          HACKATHON DEMO
        </div>
        <div class="pill pill-secondary">
          ANTI-SCAM SEMANTIC FIREWALL
        </div>
      </div>

      <h1 class="hero-title">AI Semantic Governance Engine</h1>
      <h2 class="hero-sub">語意治理與詐騙偵測 Demo</h2>

      <p class="hero-desc">
        Paste any suspicious message. The engine will analyze risk,
        responsibility chain (SCBKR), and suggest safe actions.
        貼上可疑訊息，系統將標記風險、拆解責任鏈並給出行動建議。
      </p>

      <div class="hero-meta">
        <div>
          <strong>Author 作者：</strong>沈耀 888π / Wen-Yao Hsu（Taichung, Taiwan）
        </div>
        <div>
          <strong>Focus：</strong>Semantic Firewall・SCBKR・Ex(y)=π 角色治理
        </div>
      </div>

      <div class="hero-actions">
        <a class="btn-chip btn-chip-primary" href="#input">
          <span class="btn-dot"></span>
          <span>
            <span class="btn-text-small">LIVE</span>
            <span class="btn-label">Demo for Anti-Scam Track ｜ 反詐騙組 Demo</span>
          </span>
        </a>
        <a class="btn-chip" href="https://github.com/HIJO790401/anti-scam-semantic-firewall" target="_blank">
          <span class="btn-text-small">VIEW</span>
          <span class="btn-label">Source on GitHub（Placeholder）</span>
        </a>
      </div>
    </header>

    <main class="layout-main">
      <!-- LEFT: INPUT + ANALYSIS -->
      <section class="panel" id="input">
        <header class="panel-header">
          <div>
            <div class="panel-title">INPUT ｜ 可疑訊息輸入</div>
            <div class="panel-subtitle">
              Paste SMS / Line / Email / Web text that may be a scam.
              貼上簡訊、Line、Email 或網頁內容。
            </div>
          </div>
          <div class="panel-tag">LLM-AGNOSTIC FRONT LAYER</div>
        </header>

        <div class="panel-body">
          <div class="input-area">
            <label class="example-label">例如：</label>
            <textarea id="messageInput" placeholder="貼上疑似詐騙訊息／簡訊／來電話術…"></textarea>
          </div>

          <div class="input-footer">
            <div class="input-footer-top">
              <div class="warning">
                <span class="warning-icon">!</span>
                <span>請勿貼入真實密碼或完整身分證號。</span>
              </div>
            </div>

            <div class="btn-row">
              <button class="btn btn-secondary" id="clearBtn">CLEAR 清除</button>
              <button class="btn btn-primary" id="analyzeBtn">ANALYZE 分析</button>
            </div>
          </div>
        </div>

        <!-- RISK + SCBKR -->
        <section class="risk-panel">
          <header class="risk-header">
            <div class="risk-title">RISK LEVEL ｜ 風險等級</div>
            <div class="risk-badge" id="riskBadge">SAFE</div>
          </header>
          <p class="risk-body" id="riskSummary">
            Waiting for input. 請貼上訊息後按「分析」。
          </p>

          <div class="grid-2">
            <div class="mini-panel">
              <div class="mini-title">
                <span>SCBKR RESPONSIBILITY CHAIN ｜ 責任鏈拆解</span>
                <span class="status-pill status-idle" id="scbkrStatus">Status：Idle 待分析</span>
              </div>
              <div class="mini-body" id="scbkrBody">
                Subject・Cause・Boundary・Cost・Responsibility<br />
                若某些欄位缺失，代表此訊息在責任鏈上存在「追溯空白」，風險更高。
              </div>
            </div>

            <div class="mini-panel">
              <div class="mini-title">
                <span>EVIDENCE PATTERNS ｜ 語意特徵與線索</span>
                <span class="status-pill status-idle" id="patternStatus">Detected：0 個特徵</span>
              </div>
              <div class="mini-body" id="patternBody">
                表明詐騙行為的關鍵字詞／模式，例如「急迫期限」、「威脅凍結」、「要求私下轉帳」等。
              </div>
            </div>
          </div>

          <div class="mini-panel" style="margin-top: 10px;">
            <div class="mini-title">
              <span>ACTION GUIDANCE ｜ 行動建議</span>
              <span class="status-pill status-idle" id="actionStatus">Awaiting input 等待輸入</span>
            </div>
            <div class="mini-body">
              <ul class="action-list" id="actionList">
                <li>暫停所有回覆與點擊，先確認訊息來源。</li>
                <li>透過官方網站、客服電話或實體分行自行查證，不要使用訊息中提供的聯絡資訊。</li>
              </ul>
            </div>
          </div>

          <div class="role-panel">
            <div class="role-header">
              <div class="role-title">ROLE INTEGRITY ｜ EX(Y)=π 治理層</div>
              <div class="panel-tag" style="border-color: rgba(246,196,83,0.7); color:#ffe9b8;">
                Model Role = Tool Only 工具層，不是決策者
              </div>
            </div>
            <p class="mini-body">
              Checks if the message pretends to be bank / gov / platform.
              檢查訊息是否偽裝成銀行／政府／平台。
              <span class="toggle-link" id="roleToggle">顯示詳細語意角色檢查</span>
            </p>
            <div class="role-body" id="roleDetail">
              <p>
                此層使用 Ex(y)=π 角色治理模型，確保：
              </p>
              <ul class="action-list">
                <li>AI 與審查工具永遠是「工具層」，不會被當成真正決策者。</li>
                <li>訊息若偽裝成「銀行／政府／官方平台」，會被標記為高風險。</li>
                <li>最終決策與責任必須回到「人」與「正式機構」。</li>
              </ul>
            </div>
          </div>
        </section>
      </section>

      <!-- RIGHT: EXPLANATION / NOTES -->
      <aside class="sidebar">
        <section class="panel">
          <header class="panel-header">
            <div>
              <div class="panel-title">ENGINE NOTES ｜ 引擎說明</div>
              <div class="panel-subtitle">
                基於 SCBKR 責任鏈、語意風險分級與 Ex(y)=π 角色治理。
              </div>
            </div>
          </header>
          <div class="panel-body">
            <p class="note">
              <strong>SCBKR 責任鏈：</strong>
              S 主體、C 原因、B 邊界、K 成本、R 責任。缺 S/C/B 視為邏輯殘缺，缺 K/R
              則標記為「不可結案」，必須有真人或正式機構介入。
            </p>
            <p class="note">
              <strong>Semantic Firewall V3：</strong>
              將輸出分為 SAFE、RISK、FATAL、NON-CLOSABLE，並保留可審計的語意紀錄，方便後續追溯。
            </p>
            <p class="note">
              <strong>Ex(y)=π 角色治理：</strong>
              確保 AI 與工具永遠只是「輔助證據」，不會被視為真正的決策主體或合約持有人。
            </p>
            <p class="note">
              本 Demo 僅為前端語意治理展示，不會儲存貼上的內容。實際專案可串接後端記錄、審計與報表。
            </p>
          </div>
        </section>
      </aside>
    </main>
  </div>

 <script>
    const textarea = document.getElementById("messageInput");
    const riskBadge = document.getElementById("riskBadge");
    const riskSummary = document.getElementById("riskSummary");
    const scbkrStatus = document.getElementById("scbkrStatus");
    const scbkrBody = document.getElementById("scbkrBody");
    const patternStatus = document.getElementById("patternStatus");
    const patternBody = document.getElementById("patternBody");
    const actionStatus = document.getElementById("actionStatus");
    const actionList = document.getElementById("actionList");
    const clearBtn = document.getElementById("clearBtn");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const roleToggle = document.getElementById("roleToggle");
    const roleDetail = document.getElementById("roleDetail");

    function setRisk(level, text) {
      riskBadge.textContent = level;
      riskSummary.textContent = text;
      riskBadge.className = "risk-badge";
      if (level === "SAFE") {
        riskBadge.classList.add("status-safe");
      } else if (level === "RISK") {
        riskBadge.classList.add("status-risk");
      } else if (level === "FATAL") {
        riskBadge.classList.add("status-fatal");
      }
    }

    function analyzeMessage() {
      const text = (textarea.value || "").trim();
      if (!text) {
        setRisk("SAFE", "Waiting for input. 請貼上訊息後按「分析」。");
        scbkrStatus.textContent = "Status：Idle 待分析";
        scbkrStatus.className = "status-pill status-idle";
        scbkrBody.textContent =
          "Subject・Cause・Boundary・Cost・Responsibility\n若某些欄位缺失，代表此訊息在責任鏈上存在「追溯空白」，風險更高。";
        patternStatus.textContent = "Detected：0 個特徵";
        patternStatus.className = "status-pill status-idle";
        patternBody.textContent =
          "表明詐騙行為的關鍵字詞／模式，例如「急迫期限」、「威脅凍結」、「要求私下轉帳」等。";
        actionStatus.textContent = "Awaiting input 等待輸入";
        actionStatus.className = "status-pill status-idle";
        actionList.innerHTML =
          "<li>暫停所有回覆與點擊，先確認訊息來源。</li>" +
          "<li>透過官方網站、客服電話或實體分行自行查證。</li>";
        return;
      }

      const lowered = text.toLowerCase();
      let risk = "SAFE";
      let riskText = "訊息未出現明顯高風險特徵，仍建議保持警覺並再次確認來源。";

      let fatalHits = 0;
      let riskHits = 0;
      const fatalKeywords = ["匯款", "轉帳", "帳號", "銀行", "otp", "一次性密碼", "投資", "虛擬貨幣"];
      const riskKeywords = ["限時", "30 分鐘", "立即", "凍結", "停用", "清查", "客服", "專員", "帳戶異常"];

      fatalKeywords.forEach((kw) => {
        if (text.includes(kw)) fatalHits++;
      });
      riskKeywords.forEach((kw) => {
        if (text.includes(kw)) riskHits++;
      });

      const looksOfficial =
        /銀行|信用卡|警察局|檢察署|法院|政府|內政部|國稅局|海關|電信公司|官方|專員/.test(text);

      let missingSCBKR = [];

      if (!/我|本公司|本行|本局|本單位|客服專員|某某銀行/.test(text)) {
        missingSCBKR.push("S 主體不明");
      }
      if (!/因.*(風險|異常|欠費|逾期|違規)/.test(text)) {
        missingSCBKR.push("C 原因不清");
      }
      if (!/透過.*(官網|客服電話|臨櫃)|請撥打.*客服|請至最近分行/.test(text)) {
        missingSCBKR.push("B 邊界流程不明");
      }
      if (!/可能.*損失|風險|影響/.test(text)) {
        missingSCBKR.push("K 成本未清楚說明");
      }
      if (!/本行將負責|本公司負責|依約處理/.test(text)) {
        missingSCBKR.push("R 責任未承諾");
      }

      if (fatalHits >= 2 || (fatalHits >= 1 && riskHits >= 1 && looksOfficial)) {
        risk = "FATAL";
        riskText =
          "訊息高度疑似詐騙，包含金錢轉移與假冒官方單位等特徵。請勿點擊任何連結或提供資料，直接透過官方管道查證。";
      } else if (riskHits >= 1 || looksOfficial) {
        risk = "RISK";
        riskText =
          "訊息具有多項風險特徵，建議不要直接依照指示操作，請改用官方客服或官網自行查證。";
      }

      setRisk(risk, riskText);

      if (missingSCBKR.length === 0) {
        scbkrStatus.textContent = "SCBKR 完整，但仍需人工判斷";
        scbkrStatus.className = "status-pill status-safe";
        scbkrBody.textContent =
          "訊息在主體、原因、邊界、成本與責任上皆有敘述，但是否可信仍需比對實際官方管道。";
      } else {
        scbkrStatus.textContent = `核心缺失 ${missingSCBKR.length}，K/R 可能不足`;
        scbkrStatus.className =
          risk === "FATAL"
            ? "status-pill status-fatal"
            : "status-pill status-risk";
        scbkrBody.textContent =
          "偵測到以下責任鏈缺口：\n- " +
          missingSCBKR.join("\n- ") +
          "\n缺口越多，代表此訊息越不適合作為正式依據。";
      }

      let patterns = [];
      if (looksOfficial) {
        patterns.push("偵測到詐騙關鍵字：偽裝官方單位（銀行／政府／平台）");
      }
      if (/30 ?分|60 ?分|立即|馬上|現在/.test(text)) {
        patterns.push("偵測到詐騙關鍵字：急迫時限，強調「立刻處理」");
      }
      if (/凍結|停用|鎖卡|停機/.test(text)) {
        patterns.push("偵測到詐騙關鍵字：凍結／停用威脅");
      }
      if (/點選|點擊|連結|網址/.test(text)) {
        patterns.push("偵測到模式：要求點擊連結完成驗證或領取權益");
      }
      if (/匯款|轉帳|帳號|卡號|OTP|一次性密碼/.test(text)) {
        patterns.push("偵測到模式：要求提供帳戶或一次性密碼資訊");
      }

      const count = patterns.length;
      patternStatus.textContent = `Detected：${count} 個特徵`;
      patternStatus.className =
        count === 0 ? "status-pill status-idle" : "status-pill status-risk";
      patternBody.textContent =
        count === 0
          ? "未明顯偵測到詐騙特徵，但仍建議確認訊息來源與官方管道。"
          : patterns.map((p) => "• " + p).join("\n");

      actionStatus.textContent =
        risk === "SAFE"
          ? "建議：仍需基本查證"
          : risk === "RISK"
          ? "建議：高風險訊息，勿直接操作"
          : "建議：極高風險，立即停止互動";
      actionStatus.className =
        risk === "SAFE"
          ? "status-pill status-safe"
          : risk === "RISK"
          ? "status-pill status-risk"
          : "status-pill status-fatal";

      const actions = [];
      actions.push("暫停所有回覆、點擊與操作，先冷靜確認。");
      actions.push("不要使用訊息中附上的電話或連結，改用官方網站或客服電話自行查證。");
      if (risk !== "SAFE") {
        actions.push("若已提供任何個資或金流資訊，請立即聯繫銀行或相關機構。");
      }
      if (risk === "FATAL") {
        actions.push("考慮向警方或 165 反詐騙專線通報，以保留證據。");
      }
      actionList.innerHTML = actions.map((a) => `<li>${a}</li>`).join("");
    }

    analyzeBtn.addEventListener("click", analyzeMessage);
    clearBtn.addEventListener("click", () => {
      textarea.value = "";
      analyzeMessage();
    });

    roleToggle.addEventListener("click", () => {
      roleDetail.classList.toggle("show");
    });

    analyzeMessage();
  </script>
</body>
</html>
